<!DOCTYPE html>
<html lang="en">
	<head>
		<title>three.js webgl - OrbitControls</title>
		<meta charset="utf-8" />
		<meta
			name="viewport"
			content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0"
		/>
		<link type="text/css" rel="stylesheet" href="main.css" />
		<style>
			body {
				background-color: #ccc;
				color: rgb(255, 255, 255);
			}

			a {
				color: #f00;
			}
		</style>
	</head>

	<body>
		<div id="info">
			<a href="https://threejs.org" target="_blank" rel="noopener">three.js</a>
			- OrbitControls
		</div>

		<script type="module">
			import * as THREE from "../build/three.module.js";

			import { GUI } from "./jsm/libs/dat.gui.module.js";

			import { OrbitControls } from "./jsm/controls/OrbitControls.js";

			let camera, controls, scene, renderer, gui, point, plane, meshes, material;


			let gui_params={
				transparent:false,
				opacity:1,
				alphaMap:"None"
			}

			let alpha_map=new THREE.TextureLoader().load('./textures/alphaMap.jpg');

			init();
			//render(); // remove when using next line for animation loop (requestAnimationFrame)
			animate();

			function init() {
				scene = new THREE.Scene();
				scene.background = new THREE.Color(0x333333);

				renderer = new THREE.WebGLRenderer({
					antialias: true,
					logarithmicDepthBuffer: true,
				});
				renderer.setPixelRatio(window.devicePixelRatio);
				renderer.setSize(window.innerWidth, window.innerHeight);
				document.body.appendChild(renderer.domElement);

				camera = new THREE.PerspectiveCamera(
					60,
					window.innerWidth / window.innerHeight,
					0.1,
					3000
				);
				camera.position.set(0, 200, 1000);

				// controls

				controls = new OrbitControls(camera, renderer.domElement);
				controls.enableDamping = true;
				controls.maxDistance = 1500;

				// world

				const geometry = new THREE.CylinderGeometry(1, 1, 1, 32);
				geometry.translate(0, 0.5, 0);
				material = new THREE.MeshPhongMaterial({
					color: 0xffffff,
					side:THREE.DoubleSide
				});

				meshes = new THREE.Object3D();

				for (let i = 0; i < 100; i++) {
					let mesh = new THREE.Mesh(geometry, material);
					mesh.position.x = Math.random() * 1800 - 900;
					mesh.position.y = 0;
					mesh.position.z = Math.random() * 1800 - 900;
					mesh.scale.x = 10;
					mesh.scale.y = Math.random() * 100 + 100;
					mesh.scale.z = 10;
					mesh.updateMatrix();
					mesh.matrixAutoUpdate = false;
					meshes.add(mesh);
				}
				scene.add(meshes);

				var planegeometry = new THREE.PlaneGeometry(2000, 2000);
				plane = new THREE.Mesh(planegeometry, material);
				plane.rotation.x = Math.PI / 2;
				plane.position.y = -0.01;
				meshes.add(plane);

				// lights

				const dirLight1 = new THREE.DirectionalLight(0xffffff);
				dirLight1.position.set(1, 1, 1);
				scene.add(dirLight1);

				const dirLight2 = new THREE.DirectionalLight(0x00ffff * Math.random());
				dirLight2.position.set(-1, -1, -1);
				scene.add(dirLight2);

				const ambientLight = new THREE.AmbientLight(0x222222);
				scene.add(ambientLight);

				//

				window.addEventListener("resize", onWindowResize);

				gui = new GUI();
				gui.add(gui_params, "transparent").onChange(()=>Change_Material());
				gui.add(gui_params, "opacity",0,1,0.1).onChange(()=>Change_Material());
				gui.add(gui_params, "alphaMap",["None","Fiber"]).onChange(()=>Change_Material());
			}

			function Change_Material(){
				for(let child of meshes.children){
					material.transparent=gui_params.transparent;
					material.opacity=gui_params.opacity;
					material.alphaMap=gui_params.alphaMap=="None"?null:alpha_map;
				}
			}

			function onWindowResize() {
				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();

				renderer.setSize(window.innerWidth, window.innerHeight);
			}

			function animate() {
				requestAnimationFrame(animate);

				controls.update(); // only required if controls.enableDamping = true, or if controls.autoRotate = true

				gui.updateDisplay();

				render();
			}

			function render() {
				renderer.render(scene, camera);
			}
		</script>
	</body>
</html>
